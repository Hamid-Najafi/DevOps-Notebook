services:
  jira:
    # image: atlassian/jira-software:latest
    image: haxqer/jira:9.12.1
    restart: always
    container_name: jira
    environment:
      - ATL_JDBC_URL=jdbc:postgresql://db:5432/jira
      - ATL_JDBC_USER=jira
      - ATL_JDBC_PASSWORD=PostgreSQLpass.24
      - TZ=Asia/Tehran
      - JVM_MINIMUM_MEMORY=1g
      - JVM_MAXIMUM_MEMORY=12g
      - JVM_CODE_CACHE_ARGS='-XX:InitialCodeCacheSize=1g -XX:ReservedCodeCacheSize=8g'
    # ports:
    #   - 8080:8080
    depends_on:
      - postgresql
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jira.rule=Host(`jira.c1tech.group`)"
      - "traefik.http.services.jira.loadbalancer.server.port=80"
      - "traefik.http.routers.jira.entrypoints=secure"
      - "traefik.http.routers.jira.tls.certresolver=letsencrypt"
    volumes:
      - jira-jira-data:/var/atlassian/application-data/jira:Z
    networks:
      - db
      - web

  postgresql:
    image: postgres:13
    restart: always
    container_name: confluence-postgres
    environment:
      POSTGRES_DB: jira
      POSTGRES_USER: jira
      POSTGRES_PASSWORD: PostgreSQLpass.24
    volumes:
      - jira-postgresql-data:/var/lib/postgresql/data
    networks:
      - db

networks:
  db:
    internal: true
  web:
    external: true

volumes:
  jira-postgresql-data:
      external: true
  jira-jira-data:
      external: true

